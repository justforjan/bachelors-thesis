---
title: "Bachelor's Thesis - Data Preparation"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
editor_options: 
  markdown: 
    wrap: 72
---

# Data Preparation

## load libaries

```{r}
library(tidyverse)
library(countrycode)
library(zoo)

source("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/code/functions.R")
```

women_in_parliament, basic_sanitation, basic_water_source, electricity,
employment_rate, material_footprint, forest_area, mean_years_in_school,
air_pollution, health_worker, red_list, poverty, life_expectancy,
income, income_share_20, CO2, murder

# Load data

## **Gapminder**

```{r}
# Input
# 5:
women_in_parliament <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/percentage_women_in_parliament.csv",show_col_types = FALSE)
# 6:
basic_sanitation <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/at_least_basic_sanitation_overall_access_percent.csv",show_col_types = FALSE)
basic_water_source <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/at_least_basic_water_source_overall_access_percent.csv",show_col_types = FALSE)
# 7:
electricity <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/access_to_electricity.csv",show_col_types = FALSE)
# 8:
employment_rate <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/aged_15plus_employment_rate_percent.csv",show_col_types = FALSE)
# 12:
material_footprint <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/matfootp_cap.csv",show_col_types = FALSE)
# 15:
forest_area <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/forest_area.csv",show_col_types = FALSE)

foreign_investment <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/foreign_direct_investment_net_inflows_percent_of_gdp.csv",show_col_types = FALSE)

# democracy <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/demox_eiu.csv",show_col_types = FALSE)

# Output
# 1:
poverty <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/extreme_poverty_percent_people_below_190_a_day.csv",show_col_types = FALSE)
# 3:
life_expectancy <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/life_expectancy_years.csv",show_col_types = FALSE)
# 8:
income <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/income_per_person_gdppercapita_ppp_inflation_adjusted.csv",show_col_types = FALSE)
# 10:
income_share_20 <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/income_share_of_poorest_20percent.csv",show_col_types = FALSE)
# 13:
CO2 <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/co2_emissions_tonnes_per_person.csv",show_col_types = FALSE)
# deaths_natural_disaster <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/number_of_natural_disaster_death_tot.csv",show_col_types = FALSE) # Total -> has to be calculated to /100k
# 16:
murder <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/murder_per_100000_people.csv",show_col_types = FALSE)

hdi <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/hdi_human_development_index.csv",show_col_types = FALSE)

```

## **OurWorldInData**

```{r}
# 3:
health_worker <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/physicians-per-1000-people.csv",show_col_types = FALSE)
# 4:
mean_years_in_school <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/mean-years-of-schooling.csv",show_col_types = FALSE)
# 11:
air_pollution <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/PM25-air-pollution.csv",show_col_types = FALSE)
# 15:
red_list <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/red-list-index.csv",show_col_types = FALSE)
```

### Adaption of OurWorldInData data sets

```{r}
health_worker[,2] <- NULL
mean_years_in_school[,2] <- NULL
air_pollution[,2] <- NULL
red_list[,2] <- NULL

colnames(health_worker) <- c("country", "year", "value")
colnames(mean_years_in_school) <- c("country", "year", "value")
colnames(air_pollution) <- c("country", "year", "value")
colnames(red_list) <- c("country", "year", "value")
```

# Change every table to long format

Only for Gapminder

```{r}
women_in_parliament <- to_long(women_in_parliament)
basic_sanitation <- to_long(basic_sanitation)
basic_water_source <- to_long(basic_water_source)
electricity <- to_long(electricity)
employment_rate <- to_long(employment_rate)
material_footprint <- to_long(material_footprint)
forest_area <- to_long(forest_area)
poverty <- to_long(poverty)
life_expectancy <- to_long(life_expectancy)
income <- to_long(income)
income_share_20 <- to_long(income_share_20)
CO2 <- to_long(CO2)
murder <- to_long(murder)
foreign_investment <- to_long(foreign_investment)
hdi <- to_long(hdi)
```

# Adapt data types

-   CO2 mü

-   Income k

-   foreign mü und langer Strich

```{r}
# CO2
CO2$value <- as.numeric(gsub("µ", "e-3", CO2$value))

# FDI

foreign_investment$value <- as.numeric(gsub("−", "-", foreign_investment$value)) # For some reason 5 values become NA here...

foreign_investment$value <- gsub("µ", "e-3", foreign_investment$value)

foreign_investment$value <- as.numeric(foreign_investment$value)
  
# Income
income$value <- as.numeric(gsub("k", "e3", income$value))/1000 # divided by 1000 to avoid different orders of magnitude within dataset

women_in_parliament <- women_in_parliament %>% mutate(year = as.numeric(year))
basic_sanitation <- basic_sanitation %>% mutate(year = as.numeric(year))
basic_water_source <- basic_water_source %>% mutate(year = as.numeric(year))
electricity <- electricity %>% mutate(year = as.numeric(year))
employment_rate <- employment_rate %>% mutate(year = as.numeric(year))
material_footprint <- material_footprint %>% mutate(year = as.numeric(year))
forest_area <- forest_area %>% mutate(year = as.numeric(year))
mean_years_in_school <- mean_years_in_school %>% mutate(year = as.numeric(year))
health_worker <- health_worker %>% mutate(year = as.numeric(year))
air_pollution <- air_pollution %>% mutate(year = as.numeric(year))
red_list <- red_list %>% mutate(year = as.numeric(year))
poverty <- poverty %>% mutate(year = as.numeric(year))
life_expectancy <- life_expectancy %>% mutate(year = as.numeric(year))
income <- income %>% mutate(year = as.numeric(year))
income_share_20 <- income_share_20 %>% mutate(year = as.numeric(year))
CO2 <- CO2 %>% mutate(year = as.numeric(year))
murder <- murder %>% mutate(year = as.numeric(year))
foreign_investment <- foreign_investment %>% mutate(year = as.numeric(year))
hdi <- hdi %>% mutate(year = as.numeric(year))
```

# Interpolate

```{r}
women_in_parliament <- interpolate(women_in_parliament)
basic_sanitation <- interpolate(basic_sanitation)
basic_water_source <- interpolate(basic_water_source)
electricity <- interpolate(electricity)
employment_rate <- interpolate(employment_rate)
material_footprint <- interpolate(material_footprint)
forest_area <- interpolate(forest_area)
mean_years_in_school <- interpolate(mean_years_in_school)
air_pollution <- interpolate(air_pollution)
health_worker <- interpolate(health_worker)
red_list <- interpolate(red_list)
poverty <- interpolate(poverty)
life_expectancy <- interpolate(life_expectancy)
income <- interpolate(income)
income_share_20 <- interpolate(income_share_20)
CO2 <- interpolate(CO2)
murder <- interpolate(murder)
foreign_investment <- interpolate(foreign_investment)
hdi <- interpolate(hdi)
```

# Remove years

```{r}
min_year = 1950
max_year = 2020

women_in_parliament <- rm.years(women_in_parliament)
basic_sanitation <- rm.years(basic_sanitation)
basic_water_source <- rm.years(basic_water_source)
electricity <- rm.years(electricity)
employment_rate <- rm.years(employment_rate)
material_footprint <- rm.years(material_footprint)
forest_area <- rm.years(forest_area)
mean_years_in_school <- rm.years(mean_years_in_school)
air_pollution <- rm.years(air_pollution)
health_worker <- rm.years(health_worker)
red_list <- rm.years(red_list)
poverty <- rm.years(poverty)
life_expectancy <- rm.years(life_expectancy)
income <- rm.years(income)
income_share_20 <- rm.years(income_share_20)
CO2 <- rm.years(CO2)
murder <- rm.years(murder)
foreign_investment <- rm.years(foreign_investment)
```

# Handle differences in naming conventions

```{r}
nc <- read_csv("naming_conventions.csv", show_col_types = FALSE)

for (country in 1:nrow(nc)) {
  women_in_parliament[women_in_parliament == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  basic_sanitation[basic_sanitation == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  basic_water_source[basic_water_source == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  electricity[electricity == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  employment_rate[employment_rate == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  material_footprint[material_footprint == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  forest_area[forest_area == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  mean_years_in_school[mean_years_in_school == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  air_pollution[air_pollution == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  health_worker[health_worker == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  red_list[red_list == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  poverty[poverty == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  life_expectancy[life_expectancy == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  income[income == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  income_share_20[income_share_20 == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  CO2[CO2 == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  murder[murder == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  foreign_investment[foreign_investment == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  hdi[hdi == as.character(nc[country,1])] <- as.character(nc[country,2])

}
```

# Merge country and year to DMU

and delete country and year column

```{r}
# rm.country_year = TRUE
women_in_parliament <- merge_dmu(women_in_parliament)
basic_sanitation <- merge_dmu(basic_sanitation)
basic_water_source <- merge_dmu(basic_water_source)
electricity <- merge_dmu(electricity)
employment_rate <- merge_dmu(employment_rate)
material_footprint <- merge_dmu(material_footprint)
forest_area <- merge_dmu(forest_area)
mean_years_in_school <- merge_dmu(mean_years_in_school)
air_pollution <- merge_dmu(air_pollution)
health_worker <- merge_dmu(health_worker)
red_list <- merge_dmu(red_list)
poverty <- merge_dmu(poverty)
life_expectancy <- merge_dmu(life_expectancy)
income <- merge_dmu(income)
income_share_20 <- merge_dmu(income_share_20)
CO2 <- merge_dmu(CO2)
murder <- merge_dmu(murder)
foreign_investment <- merge_dmu(foreign_investment)
hdi <- merge_dmu(hdi)

```

# Export to csv

```{r}
write_csv(women_in_parliament, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/women_in_parliament.csv")
write_csv(basic_sanitation, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/basic_sanitation.csv")
write_csv(basic_water_source, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/basic_water_source.csv")
write_csv(electricity, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/electricity.csv")
write_csv(employment_rate, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/employment_rate.csv")
write_csv(material_footprint, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/material_footprint.csv")
write_csv(forest_area, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/forest_area.csv")
write_csv(mean_years_in_school, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/mean_years_in_school.csv")
write_csv(air_pollution, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/air_pollution.csv")
write_csv(health_worker, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/health_worker.csv")
write_csv(red_list, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/red_list.csv")
write_csv(poverty, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/poverty.csv")
write_csv(life_expectancy, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/life_expectancy.csv")
write_csv(income, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/income.csv")
write_csv(income_share_20, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/income_share_20.csv")
write_csv(CO2, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/CO2.csv")
write_csv(murder, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/murder.csv")
write_csv(foreign_investment, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/foreign_investment.csv")
write_csv(hdi, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/hdi.csv")
```

# Naming conventions

how I figured out which names to change

Vectors of country names of both Gapminder and OurWorldInData

```{r}
# gapminder <- unique(c(
#   women_in_parliament$country,
#   basic_sanitation$country,
#   basic_water_source$country,
#   electricity$country,
#   employment_rate$country,
#   material_footprint$country,
#   forest_area$country,
#   poverty$country,
#   life_expectancy$country,
#   income$country,
#   income_share_20$country,
#   CO2$country,
#   murder$country
# ))
# 
# ourworldindata <- unique(c(
#   mean_years_in_school$country,
#   air_pollution$country,
#   health_worker$country,
  # red_list$country
# ))
```

In gapminder, but not in ourworldindata

```{r}
# ingm <- as.data.frame(sort(setdiff(gapminder, ourworldindata)))
```

In ourworldindata but not in gapminder

```{r}
# inowid <- as.data.frame(sort(setdiff(ourworldindata, gapminder)))
```

Manual creation of csv to map country names

```{r}
# write_csv(ingm, "in_gp.csv")
# write_csv(inowid, "in_owid.csv")
```
