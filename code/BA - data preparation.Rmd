---
title: "Bachelor's Thesis - Data Preparation"
output:
  pdf_document: default
  html_document:
    df_print: paged
  word_document: default
editor_options: 
  markdown: 
    wrap: 72
---

# Data Preparation

## load libaries

```{r}
library(tidyverse)
library(deaR)
library(ggplot2)
library(countrycode)
```

women_in_parliament, basic_sanitation, basic_water_source, electricity,
employment_rate, material_footprint, forest_area, mean_years_in_school,
air_pollution, health_worker, red_list, poverty, life_expectancy,
income, income_share_20, CO2, murder

# Prepare individual data sets

## Load data

### **Gapminder**

```{r}
# Input
# 5:
women_in_parliament <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/percentage_women_in_parliament.csv",show_col_types = FALSE)
# 6:
basic_sanitation <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/at_least_basic_sanitation_overall_access_percent.csv",show_col_types = FALSE)
basic_water_source <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/at_least_basic_water_source_overall_access_percent.csv",show_col_types = FALSE)
# 7:
electricity <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/access_to_electricity.csv",show_col_types = FALSE)
# 8:
employment_rate <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/aged_15plus_employment_rate_percent.csv",show_col_types = FALSE)
# 12:
material_footprint <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/matfootp_cap.csv",show_col_types = FALSE)
# 15:
forest_area <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/forest_area.csv",show_col_types = FALSE)

# democracy <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/demox_eiu.csv",show_col_types = FALSE)

# Output
# 1:
poverty <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/extreme_poverty_percent_people_below_190_a_day.csv",show_col_types = FALSE)
# 3:
life_expectancy <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/life_expectancy_years.csv",show_col_types = FALSE)
# 8:
income <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/income_per_person_gdppercapita_ppp_inflation_adjusted.csv",show_col_types = FALSE)
# 10:
income_share_20 <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/income_share_of_poorest_20percent.csv",show_col_types = FALSE)
# 13:
CO2 <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/co2_emissions_tonnes_per_person.csv",show_col_types = FALSE)
# deaths_natural_disaster <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/number_of_natural_disaster_death_tot.csv",show_col_types = FALSE) # Total -> has to be calculated to /100k
# 16:
murder <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/gapminder/murder_per_100000_people.csv",show_col_types = FALSE)

```

### **OurWorldInData**

```{r}
# 3:
health_worker <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/physicians-per-1000-people.csv",show_col_types = FALSE)
# 4:
mean_years_in_school <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/mean-years-of-schooling.csv",show_col_types = FALSE)
# 11:
air_pollution <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/PM25-air-pollution.csv",show_col_types = FALSE)
# 15:
red_list <- read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/OurWorldInData/red-list-index.csv",show_col_types = FALSE)
```

### Adaption of OurWorldInData data sets

```{r}
health_worker[,2] <- NULL
mean_years_in_school[,2] <- NULL
air_pollution[,2] <- NULL
red_list[,2] <- NULL

colnames(health_worker) <- c("country", "year", "value")
colnames(mean_years_in_school) <- c("country", "year", "value")
colnames(air_pollution) <- c("country", "year", "value")
colnames(red_list) <- c("country", "year", "value")
```

## Remove years 1949 and earlier and 2021 and later

```{r}
drops <- as.character(c(1700:1949, 2021:2200))

# Gapminder

women_in_parliament <- women_in_parliament[ , !(names(women_in_parliament) %in% drops)]
basic_sanitation <- basic_sanitation[ , !(names(basic_sanitation) %in% drops)]
basic_water_source <- basic_water_source[ , !(names(basic_water_source) %in% drops)]
electricity <- electricity[ , !(names(electricity) %in% drops)]
employment_rate <- employment_rate[ , !(names(employment_rate) %in% drops)]
material_footprint <- material_footprint[ , !(names(material_footprint) %in% drops)]
forest_area <- forest_area[ , !(names(forest_area) %in% drops)]
poverty <- poverty[ , !(names(poverty) %in% drops)]
life_expectancy <- life_expectancy[ , !(names(life_expectancy) %in% drops)]
income <- income[ , !(names(income) %in% drops)]
income_share_20 <- income_share_20[ , !(names(income_share_20) %in% drops)]
CO2 <- CO2[ , !(names(CO2) %in% drops)]
murder <- murder[ , !(names(murder) %in% drops)]

# OurWorldInData

mean_years_in_school <- subset(mean_years_in_school, !(year %in% drops))
air_pollution <- subset(air_pollution, !(year %in% drops))
health_worker <- subset(health_worker, !(year %in% drops))
red_list <- subset(red_list, !(year %in% drops))

```

## Change tables from wide to long (Gapminder)

```{r}
women_in_parliament <- women_in_parliament %>% gather("year", "value", -country)
basic_sanitation <- basic_sanitation %>% gather("year", "value", -country)
basic_water_source <- basic_water_source %>% gather("year", "value", -country)
electricity <- electricity %>% gather("year", "value", -country)
employment_rate <- employment_rate %>% gather("year", "value", -country)
material_footprint <- material_footprint %>% gather("year", "value", -country)
forest_area <- forest_area %>% gather("year", "value", -country)
poverty <- poverty %>% gather("year", "value", -country)
life_expectancy <- life_expectancy %>% gather("year", "value", -country)
income <- income %>% gather("year", "value", -country)
income_share_20 <- income_share_20 %>% gather("year", "value", -country)
CO2 <- CO2 %>% gather("year", "value", -country)
murder <- murder %>% gather("year", "value", -country)
```

## Change data types of columns

```{r}
# Values
income$value <- as.numeric(gsub("k", "e3", income$value))/1000 # divided by 1000 to avoid different orders of magnitude within dataset

# Years
women_in_parliament <- women_in_parliament %>% mutate(year = as.numeric(year))
basic_sanitation <- basic_sanitation %>% mutate(year = as.numeric(year))
basic_water_source <- basic_water_source %>% mutate(year = as.numeric(year))
electricity <- electricity %>% mutate(year = as.numeric(year))
employment_rate <- employment_rate %>% mutate(year = as.numeric(year))
material_footprint <- material_footprint %>% mutate(year = as.numeric(year))
forest_area <- forest_area %>% mutate(year = as.numeric(year))
mean_years_in_school <- mean_years_in_school %>% mutate(year = as.numeric(year))
health_worker <- health_worker %>% mutate(year = as.numeric(year))
air_pollution <- air_pollution %>% mutate(year = as.numeric(year))
red_list <- red_list %>% mutate(year = as.numeric(year))
poverty <- poverty %>% mutate(year = as.numeric(year))
life_expectancy <- life_expectancy %>% mutate(year = as.numeric(year))
income <- income %>% mutate(year = as.numeric(year))
income_share_20 <- income_share_20 %>% mutate(year = as.numeric(year))
CO2 <- CO2 %>% mutate(year = as.numeric(year))
murder <- murder %>% mutate(year = as.numeric(year))
```

## Handle differences in naming conventions

Vectors of country names of both Gapminder and OurWorldInData

```{r}
gapminder <- unique(c(
  women_in_parliament$country,
  basic_sanitation$country,
  basic_water_source$country,
  electricity$country,
  employment_rate$country,
  material_footprint$country,
  forest_area$country,
  poverty$country,
  life_expectancy$country,
  income$country,
  income_share_20$country,
  CO2$country,
  murder$country
))

ourworldindata <- unique(c(
  mean_years_in_school$country,
  air_pollution$country,
  health_worker$country,
  red_list$country
))
```

In gapminder, but not in ourworldindata

```{r}
ingm <- as.data.frame(sort(setdiff(gapminder, ourworldindata)))
```

In ourworldindata but not in gapminder

```{r}
inowid <- as.data.frame(sort(setdiff(ourworldindata, gapminder)))
```

Manual creation of csv to map country names

```{r}
write_csv(ingm, "in_gp.csv")
write_csv(inowid, "in_owid.csv")
```

Read manually created naming conventions file

```{r}
nc <- read_csv("naming_conventions.csv", show_col_types = FALSE)
```

Change country names according to naming convention

```{r}
for (country in 1:nrow(nc)) {
  women_in_parliament[women_in_parliament == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  basic_sanitation[basic_sanitation == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  basic_water_source[basic_water_source == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  electricity[electricity == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  employment_rate[employment_rate == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  material_footprint[material_footprint == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  forest_area[forest_area == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  mean_years_in_school[mean_years_in_school == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  air_pollution[air_pollution == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  health_worker[health_worker == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  red_list[red_list == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  poverty[poverty == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  life_expectancy[life_expectancy == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  income[income == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  income_share_20[income_share_20 == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  CO2[CO2 == as.character(nc[country,1])] <- as.character(nc[country,2])
  
  murder[murder == as.character(nc[country,1])] <- as.character(nc[country,2])
  

}
```

## Merge country and year to dmu

```{r}
women_in_parliament$dmu <- str_c(women_in_parliament$country, "_", women_in_parliament$year)
basic_sanitation$dmu <- str_c(basic_sanitation$country, "_", basic_sanitation$year)
basic_water_source$dmu <- str_c(basic_water_source$country, "_", basic_water_source$year)
electricity$dmu <- str_c(electricity$country, "_", electricity$year)
employment_rate$dmu <- str_c(employment_rate$country, "_", employment_rate$year)
material_footprint$dmu <- str_c(material_footprint$country, "_", material_footprint$year)
forest_area$dmu <- str_c(forest_area$country, "_", forest_area$year)
mean_years_in_school$dmu <- str_c(mean_years_in_school$country, "_", mean_years_in_school$year)
air_pollution$dmu <- str_c(air_pollution$country, "_", air_pollution$year)
health_worker$dmu <- str_c(health_worker$country, "_", health_worker$year)
red_list$dmu <- str_c(red_list$country, "_", red_list$year)
poverty$dmu <- str_c(poverty$country, "_", poverty$year)
life_expectancy$dmu <- str_c(life_expectancy$country, "_", life_expectancy$year)
income$dmu <- str_c(income$country, "_", income$year)
income_share_20$dmu <- str_c(income_share_20$country, "_", income_share_20$year)
CO2$dmu <- str_c(CO2$country, "_", CO2$year)
murder$dmu <- str_c(murder$country, "_", murder$year)

women_in_parliament$country <- NULL
basic_sanitation$country <- NULL
basic_water_source$country <- NULL
electricity$country <- NULL
employment_rate$country <- NULL
material_footprint$country <- NULL
forest_area$country <- NULL
mean_years_in_school$country <- NULL
air_pollution$country <- NULL
health_worker$country <- NULL
red_list$country <- NULL
poverty$country <- NULL
life_expectancy$country <- NULL
income$country <- NULL
income_share_20$country <- NULL
CO2$country <- NULL
murder$country <- NULL

women_in_parliament$year <- NULL
basic_sanitation$year <- NULL
basic_water_source$year <- NULL
electricity$year <- NULL
employment_rate$year <- NULL
material_footprint$year <- NULL
forest_area$year <- NULL
mean_years_in_school$year <- NULL
air_pollution$year <- NULL
health_worker$year <- NULL
red_list$year <- NULL
poverty$year <- NULL
life_expectancy$year <- NULL
income$year <- NULL
income_share_20$year <- NULL
CO2$year <- NULL
murder$year <- NULL

women_in_parliament <- women_in_parliament %>% relocate(dmu)
basic_sanitation <- basic_sanitation %>% relocate(dmu)
basic_water_source <- basic_water_source %>% relocate(dmu)
electricity <- electricity %>% relocate(dmu)
employment_rate <- employment_rate %>% relocate(dmu)
material_footprint <- material_footprint %>% relocate(dmu)
forest_area <- forest_area %>% relocate(dmu)
mean_years_in_school <- mean_years_in_school %>% relocate(dmu)
air_pollution <- air_pollution %>% relocate(dmu)
health_worker <- health_worker %>% relocate(dmu)
red_list <- red_list %>% relocate(dmu)
poverty <- poverty %>% relocate(dmu)
life_expectancy <- life_expectancy %>% relocate(dmu)
income <- income %>% relocate(dmu)
income_share_20 <- income_share_20 %>% relocate(dmu)
CO2 <- CO2 %>% relocate(dmu)
murder <- murder %>% relocate(dmu)
```

## Save individual data sets as csvs

```{r}
write_csv(women_in_parliament, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/women_in_parliament.csv")
write_csv(basic_sanitation, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/basic_sanitation.csv")
write_csv(basic_water_source, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/basic_water_source.csv")
write_csv(electricity, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/electricity.csv")
write_csv(employment_rate, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/employment_rate.csv")
write_csv(material_footprint, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/material_footprint.csv")
write_csv(forest_area, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/forest_area.csv")
write_csv(mean_years_in_school, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/mean_years_in_school.csv")
write_csv(air_pollution, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/air_pollution.csv")
write_csv(health_worker, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/health_worker.csv")
write_csv(red_list, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/red_list.csv")
write_csv(poverty, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/poverty.csv")
write_csv(life_expectancy, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/life_expectancy.csv")
write_csv(income, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/income.csv")
write_csv(income_share_20, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/income_share_20.csv")
write_csv(CO2, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/CO2.csv")
write_csv(murder, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/raw_data/preprocessed_data/murder.csv")
```
