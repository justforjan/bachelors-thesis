---
title: "BA - DEA"
output: html_notebook
---

## load libraries

```{r}
library(tidyverse)
library(deaR)
library(ggplot2)
library(countrycode)

```

## load data

```{r}
data = read_csv("D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/processed_data/country_data_all_dmus.csv", show_col_types = FALSE)
str(data)
```

```{r}
final_3$dmu <- str_c(final_3$country, "_", final_3$year)
final_3$country <- NULL
final_3$year <- NULL
final_3 <- final_3 %>% relocate(dmu)
```

```{r}

# Documentation: https://cran.r-project.org/web/packages/deaR/deaR.pdf

# Number of in- and outputs
number_of_inputs <- 1
number_of_outputs <- 1

orientation <- "io"
# io: input oriented
# oo: output oriented

return_to_scale <- "vrs"
# crs: constant return to scale
# vrs: variable return to scale
# nirs: non-increasing
# ndrs: non-decreasing
# grs: generalized


model_data <- read_data(data, ni=number_of_inputs, no=number_of_outputs, dmus = 1)


result <- model_basic(model_data, orientation = orientation, rts=return_to_scale)

## Warning: There are data with very different orders of magnitude. Try to re-define the units of measure or some linear problems may be ill-posed.

```

## Efficiencies and Targets

```{r}
# Efficiencies
eff <- as.data.frame(efficiencies(result))
# add column for dmu names
eff$dmu <- rownames(eff)
# delete rownames
rownames(eff) <- NULL
# Rename efficiency column
colnames(eff)[1] <- "efficiencies"

# get targets
targets <- as.data.frame(targets(result))
# add column for dmu names
targets$dmu <- rownames(targets)
# delte rownames
rownames(targets) <- NULL
```

## Merge all together

```{r}
data_and_results <- list(
  data,
  eff,
  targets
)

data_dea <- data_and_results %>% reduce(full_join, by="dmu")
```

```{r}
data_dea <- data_dea %>% relocate(efficiencies, .after = dmu)
```

## Split um dmu column to country and year but keep dmu column

```{r}
data_dea <- separate(data_dea, dmu, c("country", "year"), "_", remove=FALSE)
```

## Add contintents

```{r}
data_dea$continent <- countrycode(sourcevar = data_dea$country,
                               origin = "country.name",
                               destination = "continent")
```

## export as csv

```{r}
write_csv(data_dea, "D:/Daten/Bildung/HS Mannheim/BA/bachelors-thesis/processed_data/dea_results.csv")
```
